<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Service Desk | Emet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .loader { border-top-color: #3B82F6; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* –°—Ç–∏–ª—å –¥–ª—è –æ–±–æ–≤'—è–∑–∫–æ–≤–∏—Ö –ø–æ–ª—ñ–≤ */
        .required-mark::after { content: " *"; color: red; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans h-screen flex flex-col">

    <div id="login-screen" class="fixed inset-0 bg-white z-50 flex flex-col justify-center items-center p-6">
        <div class="text-center w-full max-w-sm">
            <div class="bg-blue-100 p-4 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-user-doctor text-3xl text-blue-600"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">–í—Ö—ñ–¥ —É —Å–∏—Å—Ç–µ–º—É</h2>
            <p class="text-gray-500 mb-6">–í–≤–µ–¥—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è –¥–ª—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó</p>
            <input type="text" id="login-name" class="w-full border border-gray-300 rounded-lg p-3 mb-4 text-center text-lg" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –û–ª–µ–Ω–∞">
            <button onclick="loginUser()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg shadow hover:bg-blue-700">–£–≤—ñ–π—Ç–∏</button>
        </div>
    </div>

    <header class="bg-white shadow-sm p-4 flex justify-between items-center z-10 shrink-0">
        <h1 class="text-lg font-bold text-blue-800 flex items-center gap-2">
            <i class="fa-solid fa-notes-medical"></i> EMET Service Desk
        </h1>
        <div class="text-xs text-right leading-tight">
            <div class="text-gray-400">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</div>
            <div class="font-bold text-gray-800" id="current-user-display">...</div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto p-3 pb-24 no-scrollbar">

        <div id="tab-new" class="block">
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-4">
                <h2 class="text-lg font-semibold mb-4 text-gray-800 border-b pb-2">–ù–æ–≤–∞ —Ä–µ–∫–ª–∞–º–∞—Ü—ñ—è</h2>
                
                <form id="claimForm" onsubmit="submitForm(event)">
                    
                    <div class="mb-5">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2 required-mark">–¢–∏–ø –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è</label>
                        <select id="claimType" class="w-full bg-gray-50 border border-gray-300 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none" required>
                            <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø...</option>
                            <option value="defect_pack">üì¶ –ë—Ä–∞–∫ —É–ø–∞–∫–æ–≤–∫–∏</option>
                            <option value="quality">üíé –Ø–∫—ñ—Å—Ç—å –ø—Ä–µ–ø–∞—Ä–∞—Ç—É</option>
                            <option value="effectiveness">üìâ –ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (–Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤)</option>
                            <option value="side_effect">ü§í –ü–æ–±—ñ—á–Ω–∞ –¥—ñ—è</option>
                            <option value="complication">üöë –£—Å–∫–ª–∞–¥–Ω–µ–Ω–Ω—è</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-1 gap-3 mb-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1 required-mark">–ö–ª—ñ—î–Ω—Ç (–õ—ñ–∫–∞—Ä/–°–∞–ª–æ–Ω)</label>
                            <input type="text" id="client" class="w-full border border-gray-300 rounded-lg p-3 text-sm" placeholder="–ü–Ü–ë –ª—ñ–∫–∞—Ä—è" required>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-1 required-mark">‚Ññ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó</label>
                            <input type="text" id="invoice" class="w-full border border-gray-300 rounded-lg p-3 text-sm" placeholder="–ù–∞–ø—Ä: –†–ù-00123" required>
                        </div>
                    </div>

                    <div class="mb-5 bg-blue-50 p-3 rounded-lg border border-blue-100">
                        <label class="block text-xs font-bold text-blue-800 uppercase mb-2 required-mark">–ü—Ä–µ–ø–∞—Ä–∞—Ç</label>
                        <select id="product" onchange="renderDynamicForm()" class="w-full bg-white border border-blue-200 rounded-lg p-3 text-sm focus:ring-2 focus:ring-blue-500 outline-none" required>
                            <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –ø—Ä–µ–ø–∞—Ä–∞—Ç...</option>
                            <option value="VITARAN">HP CELL VITARAN (–≤—Å—ñ)</option>
                            <option value="NEURONOX">NEURONOX</option>
                            <option value="NEURAMIS">NEURAMIS</option>
                            <option value="ELLANSE">ELLANSE</option>
                            <option value="PETARAN">PETARAN</option>
                            <option value="OTHER">–Ü–Ω—à–µ / –ö–æ—Å–º–µ—Ü–µ–≤—Ç–∏–∫–∞</option>
                        </select>
                        
                        <div class="mt-3 grid grid-cols-2 gap-2">
                            <input type="text" id="lot" class="w-full border border-gray-300 rounded-lg p-2 text-sm" placeholder="LOT / –°–µ—Ä—ñ—è" required>
                            <input type="date" id="date_proc" class="w-full border border-gray-300 rounded-lg p-2 text-sm text-gray-500" title="–î–∞—Ç–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∏">
                        </div>
                    </div>

                    <div id="dynamic-form-area" class="hidden mb-5 border-t pt-4">
                        <h3 class="text-sm font-bold text-gray-700 mb-3"><i class="fa-solid fa-list-check mr-1"></i>–î–µ—Ç–∞–ª—ñ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—É</h3>
                        <div id="dynamic-fields" class="space-y-3">
                            </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">–§–æ—Ç–æ/–í—ñ–¥–µ–æ/–°—Ö–µ–º–∞</label>
                        <p class="text-xs text-gray-400 mb-2">–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ "–î–æ/–ü—ñ—Å–ª—è" –∞–±–æ —Ñ–æ—Ç–æ —Å—Ö–µ–º–∏ —Ä–æ–∑–º—ñ—Ç–∫–∏</p>
                        <label class="flex flex-col items-center justify-center w-full h-24 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100 transition">
                            <i class="fa-solid fa-camera text-gray-400 text-xl"></i>
                            <span class="text-xs text-gray-500 mt-1">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—ñ–≤</span>
                            <input id="dropzone-file" type="file" class="hidden" multiple accept="image/*,video/*" onchange="previewFiles()" />
                        </label>
                        <div id="preview-area" class="flex gap-2 mt-2 overflow-x-auto p-1"></div>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold py-3.5 rounded-xl shadow-lg hover:shadow-xl transition active:scale-95 flex justify-center items-center">
                        <span id="btn-text">–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Ä–µ–∫–ª–∞–º–∞—Ü—ñ—é</span>
                        <div id="btn-loader" class="loader ease-linear rounded-full border-2 border-t-2 border-white h-5 w-5 ml-2 hidden"></div>
                    </button>
                </form>
            </div>
        </div>

        <div id="tab-history" class="hidden">
            <h2 class="text-lg font-semibold mb-4 px-1">–ú–æ—ó –∑–∞—è–≤–∫–∏</h2>
            <div id="history-container" class="space-y-3"></div>
            <div id="empty-state" class="hidden text-center mt-12 text-gray-400">
                <i class="fa-regular fa-folder-open text-4xl mb-3"></i>
                <p>–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ—Ä–æ–∂–Ω—è</p>
            </div>
        </div>
    </main>

    <nav class="bg-white border-t border-gray-200 fixed bottom-0 w-full z-20 pb-safe">
        <div class="flex justify-around items-center h-16">
            <button onclick="switchTab('new')" id="nav-new" class="flex-1 h-full text-blue-600 flex flex-col items-center justify-center">
                <i class="fa-solid fa-circle-plus text-xl mb-1"></i>
                <span class="text-[10px] font-bold uppercase">–ü–æ–¥–∞—Ç–∏</span>
            </button>
            <button onclick="switchTab('history')" id="nav-history" class="flex-1 h-full text-gray-400 flex flex-col items-center justify-center">
                <i class="fa-solid fa-clock-rotate-left text-xl mb-1"></i>
                <span class="text-[10px] font-bold uppercase">–Ü—Å—Ç–æ—Ä—ñ—è</span>
            </button>
        </div>
    </nav>

    <script>
        // --- –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø –ü–û–õ–Ü–í –î–õ–Ø –†–Ü–ó–ù–ò–• –ü–†–ï–ü–ê–†–ê–¢–Ü–í (–ó–≥—ñ–¥–Ω–æ DOCX) ---
        const FORMS_CONFIG = {
            'VITARAN': [
                { id: 'tool', label: '–ß–∏–º –ø—Ä–æ–≤–æ–¥–∏–ª–∏ (–≥–æ–ª–∫–∞/–∫–∞–Ω—é–ª—è, —Ä–æ–∑–º—ñ—Ä)', type: 'text' },
                { id: 'anesthesia', label: '–ó–Ω–µ–±–æ–ª–µ–Ω–Ω—è (–ø—Ä–µ–ø–∞—Ä–∞—Ç)', type: 'text' },
                { id: 'technique', label: '–¢–µ—Ö–Ω—ñ–∫–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è', type: 'textarea' },
                { id: 'post_proc', label: '–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –ø–æ—Å—Ç–ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–≥–æ –ø–µ—Ä—ñ–æ–¥—É', type: 'textarea' },
                { id: 'allergies', label: '–ê–ª–µ—Ä–≥—ñ—ó –≤ –∞–Ω–∞–º–Ω–µ–∑—ñ', type: 'text' },
                { id: 'cosmetics', label: '–Ø–∫—É –∫–æ—Å–º–µ—Ç–∏–∫—É –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø–∞—Ü—ñ—î–Ω—Ç?', type: 'text' }
            ],
            'NEURONOX': [
                { id: 'diluent', label: '–ß–∏–º –≤—ñ–¥–Ω–æ–≤–ª—é–≤–∞–ª–∏ (–ù–∞—Ç—Ä—ñ–π —Ö–ª–æ—Ä 0.9%?) —Ç–∞ –æ–±\'—î–º', type: 'text' },
                { id: 'date_dilution', label: '–î–∞—Ç–∞ —Ä–æ–∑–≤–µ–¥–µ–Ω–Ω—è', type: 'date' },
                { id: 'prev_botox', label: '–ü–æ–ø–µ—Ä–µ–¥–Ω—è –±–æ—Ç—É–ª—ñ–Ω–æ—Ç–µ—Ä–∞–ø—ñ—è (–¥–∞—Ç–∞, –ø—Ä–µ–ø–∞—Ä–∞—Ç)', type: 'textarea' },
                { id: 'illness', label: '–ó–∞—Ö–≤–æ—Ä—é–≤–∞–Ω–Ω—è (–≥–æ—Å—Ç—Ä—ñ, —Ö—Ä–æ–Ω—ñ—á–Ω—ñ)', type: 'text' },
                { id: 'meds', label: '–Ø–∫—ñ –ª—ñ–∫–∏ –ø—Ä–∏–π–º–∞—î –∑–∞—Ä–∞–∑?', type: 'text' }
            ],
            'NEURAMIS': [
                { id: 'tool', label: '–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (–≥–æ–ª–∫–∞/–∫–∞–Ω—é–ª—è)', type: 'text' },
                { id: 'prev_contour', label: '–ö–æ–Ω—Ç—É—Ä–Ω–∞ –ø–ª–∞—Å—Ç–∏–∫–∞ –≤ —Ü—ñ–π –∑–æ–Ω—ñ —Ä–∞–Ω—ñ—à–µ?', type: 'text' },
                { id: 'hyaluronidase', label: '–ß–∏ –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞–ª–∏ —Ä–∞–Ω—ñ—à–µ –≥—ñ–∞–ª—É—Ä–æ–Ω—ñ–¥–∞–∑—É?', type: 'select', options: ['–ù—ñ', '–¢–∞–∫'] },
                { id: 'status_localis', label: 'Status Localis (–¥–∞–Ω—ñ –æ–≥–ª—è–¥—É)', type: 'textarea' }
            ],
            'ELLANSE': [
                { id: 'vaccination', label: '–î–∞—Ç–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–∞–∫—Ü–∏–Ω–∞—Ü—ñ—ó', type: 'text' },
                { id: 'autoimmune', label: '–ê—É—Ç–æ—ñ–º—É–Ω–Ω—ñ –∑–∞—Ö–≤–æ—Ä—é–≤–∞–Ω–Ω—è', type: 'text' },
                { id: 'diet', label: '–û—Å–æ–±–ª–∏–≤–∞ –¥—ñ—î—Ç–∞?', type: 'text' },
                { id: 'tool', label: '–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (—Ä–æ–∑–º—ñ—Ä)', type: 'text' }
            ],
            'PETARAN': [
                { id: 'dilution_lido', label: '–ß–∏ –¥–æ–¥–∞–≤–∞–ª–∏ –ª—ñ–¥–æ–∫–∞—ó–Ω –ø—Ä–∏ —Ä–æ–∑–≤–µ–¥–µ–Ω–Ω—ñ?', type: 'select', options: ['–ù—ñ', '–¢–∞–∫'] },
                { id: 'massage', label: '–ß–∏ —Ä–æ–±–∏–≤ –ø–∞—Ü—ñ—î–Ω—Ç –º–∞—Å–∞–∂ (–¥–æ—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó)?', type: 'select', options: ['–¢–∞–∫', '–ù—ñ', '–ù–µ –∑–Ω–∞—é'] },
                { id: 'allergies_poly', label: '–ê–ª–µ—Ä–≥—ñ—è –Ω–∞ –ø–æ–ª—ñ–Ω—É–∫–ª–µ–æ—Ç–∏–¥–∏?', type: 'text' }
            ],
            'OTHER': [
                { id: 'problem_desc', label: '–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏', type: 'textarea' }
            ]
        };

        // --- –õ–û–ì–ò–ö–ê ---
        
        function renderDynamicForm() {
            const product = document.getElementById('product').value;
            const container = document.getElementById('dynamic-form-area');
            const fieldsContainer = document.getElementById('dynamic-fields');
            
            // –û—á–∏—Å—Ç–∫–∞
            fieldsContainer.innerHTML = '';
            
            if (!product || !FORMS_CONFIG[product]) {
                container.classList.add('hidden');
                return;
            }

            container.classList.remove('hidden');
            
            // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –ø–æ–ª—ñ–≤
            FORMS_CONFIG[product].forEach(field => {
                let html = '';
                if (field.type === 'textarea') {
                    html = `<div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">${field.label}</label>
                        <textarea name="custom_${field.id}" rows="2" class="w-full bg-white border border-gray-300 rounded p-2 text-sm focus:border-blue-500 outline-none"></textarea>
                    </div>`;
                } else if (field.type === 'select') {
                    const opts = field.options.map(o => `<option>${o}</option>`).join('');
                    html = `<div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">${field.label}</label>
                        <select name="custom_${field.id}" class="w-full bg-white border border-gray-300 rounded p-2 text-sm focus:border-blue-500 outline-none">${opts}</select>
                    </div>`;
                } else {
                    html = `<div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">${field.label}</label>
                        <input type="${field.type}" name="custom_${field.id}" class="w-full bg-white border border-gray-300 rounded p-2 text-sm focus:border-blue-500 outline-none">
                    </div>`;
                }
                fieldsContainer.insertAdjacentHTML('beforeend', html);
            });
        }

        // --- –ê–í–¢–û–†–ò–ó–ê–¶–Ü–Ø –Ü –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø (–Ø–∫ –≤ –º–∏–Ω—É–ª—ñ–π –≤–µ—Ä—Å—ñ—ó) ---
        let currentUser = localStorage.getItem('emet_user');
        const MOCK_DB = []; // –ü–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç–∞—Ä—Ç

        function checkAuth() {
            if (currentUser) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('current-user-display').innerText = currentUser;
                renderHistory();
            } else {
                document.getElementById('login-screen').classList.remove('hidden');
            }
        }

        function loginUser() {
            const name = document.getElementById('login-name').value.trim();
            if (name) {
                currentUser = name;
                localStorage.setItem('emet_user', currentUser);
                checkAuth();
            }
        }

        // --- –û–ë–†–û–ë–ö–ê –§–û–†–ú–ò ---
        function submitForm(event) {
            event.preventDefault();
            const btnText = document.getElementById('btn-text');
            const btnLoader = document.getElementById('btn-loader');
            
            btnText.innerText = '–í—ñ–¥–ø—Ä–∞–≤–∫–∞...';
            btnLoader.classList.remove('hidden');

            // –ó–±–∏—Ä–∞—î–º–æ –¥–∞–Ω—ñ
            const formData = {
                type: document.getElementById('claimType').value,
                client: document.getElementById('client').value,
                invoice: document.getElementById('invoice').value,
                product: document.getElementById('product').value,
                lot: document.getElementById('lot').value,
                // –¢—É—Ç –º–∏ –± –∑—ñ–±—Ä–∞–ª–∏ –≤—Å—ñ –¥–∏–Ω–∞–º—ñ—á–Ω—ñ –ø–æ–ª—è
            };

            // –Ü–º—ñ—Ç–∞—Ü—ñ—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –≤ –ë—ñ—Ç—Ä–∏–∫—Å
            setTimeout(() => {
                const newClaim = {
                    id: Math.floor(Math.random() * 9000) + 1000,
                    date: new Date().toLocaleDateString(),
                    status: 'new',
                    statusText: '–ù–æ–≤–∞ –∑–∞—è–≤–∫–∞',
                    ...formData
                };
                
                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ –ª–æ–∫–∞–ª—å–Ω—É "–±–∞–∑—É" –¥–ª—è –¥–µ–º–æ
                let history = JSON.parse(localStorage.getItem('emet_history')) || [];
                history.unshift(newClaim);
                localStorage.setItem('emet_history', JSON.stringify(history));

                btnText.innerText = '–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ —Ä–µ–∫–ª–∞–º–∞—Ü—ñ—é';
                btnLoader.classList.add('hidden');
                
                alert('‚úÖ –†–µ–∫–ª–∞–º–∞—Ü—ñ—é —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ! \n–î–∞–Ω—ñ –ø–µ—Ä–µ–¥–∞–Ω–æ –≤ –º–µ–¥–∏—á–Ω–∏–π –≤—ñ–¥–¥—ñ–ª.');
                document.getElementById('claimForm').reset();
                document.getElementById('preview-area').innerHTML = '';
                document.getElementById('dynamic-form-area').classList.add('hidden');
                
                switchTab('history');
            }, 1500);
        }

        function renderHistory() {
            const container = document.getElementById('history-container');
            const emptyState = document.getElementById('empty-state');
            container.innerHTML = '';
            
            let history = JSON.parse(localStorage.getItem('emet_history')) || [];
            
            if (history.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            emptyState.classList.add('hidden');

            history.forEach(item => {
                const typeLabels = {
                    'defect_pack': '–ë—Ä–∞–∫ —É–ø–∞–∫–æ–≤–∫–∏',
                    'quality': '–Ø–∫—ñ—Å—Ç—å',
                    'effectiveness': '–ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å',
                    'side_effect': '–ü–æ–±—ñ—á–Ω–∞ –¥—ñ—è',
                    'complication': '–£—Å–∫–ª–∞–¥–Ω–µ–Ω–Ω—è'
                };

                const card = `
                <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-3 relative overflow-hidden">
                    <div class="absolute left-0 top-0 bottom-0 w-1 ${item.status === 'new' ? 'bg-blue-500' : 'bg-green-500'}"></div>
                    <div class="flex justify-between items-start mb-1 pl-2">
                        <span class="text-[10px] font-bold text-gray-400">#${item.id} ‚Ä¢ ${item.date}</span>
                        <span class="bg-blue-50 text-blue-700 text-[10px] font-bold px-2 py-0.5 rounded-full border border-blue-100 uppercase tracking-wide">${item.statusText}</span>
                    </div>
                    <div class="pl-2">
                        <h3 class="font-bold text-gray-800 text-sm">${item.client}</h3>
                        <p class="text-xs text-gray-500 mb-1">–†–ù: ${item.invoice}</p>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="text-xs font-semibold bg-gray-100 px-2 py-1 rounded text-gray-600">${typeLabels[item.type] || item.type}</span>
                            <span class="text-xs text-gray-500 border border-gray-200 px-2 py-1 rounded">${item.product}</span>
                        </div>
                    </div>
                </div>`;
                container.innerHTML += card;
            });
        }

        function switchTab(tabName) {
            document.getElementById('tab-new').classList.toggle('hidden', tabName !== 'new');
            document.getElementById('tab-history').classList.toggle('hidden', tabName !== 'history');
            
            const navNew = document.getElementById('nav-new');
            const navHist = document.getElementById('nav-history');
            
            if(tabName === 'new') {
                navNew.classList.add('text-blue-600'); navNew.classList.remove('text-gray-400');
                navHist.classList.add('text-gray-400'); navHist.classList.remove('text-blue-600');
            } else {
                navHist.classList.add('text-blue-600'); navHist.classList.remove('text-gray-400');
                navNew.classList.add('text-gray-400'); navNew.classList.remove('text-blue-600');
                renderHistory();
            }
        }

        function previewFiles() {
            const preview = document.getElementById('preview-area');
            const files = document.getElementById('dropzone-file').files;
            preview.innerHTML = '';
            if (files) {
                [].forEach.call(files, function(file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const div = document.createElement('div');
                        div.className = 'flex-shrink-0 w-14 h-14 rounded-lg overflow-hidden border border-gray-200';
                        div.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover">`;
                        preview.appendChild(div);
                    }
                    reader.readAsDataURL(file);
                });
            }
        }

        checkAuth();
    </script>
</body>
</html>
